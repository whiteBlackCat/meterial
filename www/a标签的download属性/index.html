<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
  <!-- download属性使得图片下载而不是预览 -->
  <a id="download" href="#" download="download">download</a>
  <!-- <img id="dl" src="521dfe899ffb54b7a7b3bff076e442e8_b" alt=""> -->
  <form id="myform" enctype="multipart/form-data">
    <label for="">姓名</label>
    <input type="text" value="123"><br>
    <label for="">年龄</label>
    <input type="text" value="321"><br>
    <label for="">性别</label>
    <label><input name="sex" type="radio" value="1" />香蕉 </label>
    <label><input name="sex" type="radio" value="2" />梨 </label><br>
    <input id="upload" type="file">
  </form>
  <button id="btn">get file</button>
  <script>
    $(function () {
      // $('#download').attr('href', '521dfe899ffb54b7a7b3bff076e442e8_b')
      // funDownload('测试保存字符串为文件','test.txt',true)
      // funDownload($('#dl')[0],'test.jpg',false)

      // 字符串与二进制数据相互转换 
      var bi = window.btoa(window.encodeURIComponent('嘻嘻哈哈哈哈啦啦啦啦'));
      console.log(bi)
      var str = decodeURIComponent(window.atob(bi))
      console.log(str)

      var reader = new FileReader();
      reader.onload = function (e) {
        // e.target.result就是该文件的完整Base64 Data-URI
        console.log(e)
      };
      $('#btn').click(function () {
        var file = $('#upload').val()
        console.log(file)
        reader.readAsDataURL(file);
      })
    })
    /**
     * 保存字符串/图片至文件 
     * @param {string/DOM} content 具体是string还是DOM则看flag使用的方法
     * @param {string} filename 保存的文件名
     * @parma {Boolean} flag true:将字符转blob, false:将图片转base64
     */
    var funDownload = function (content, filename, flag) {
      // 创建隐藏的可下载链接
      var eleLink = document.createElement('a');
      eleLink.download = filename;
      eleLink.style.display = 'none';

      if (flag) {
        // 字符内容转变成blob地址
        var blob = new Blob([content]);
        eleLink.href = URL.createObjectURL(blob);
      } else {
        // 图片转base64地址
        var canvas = document.createElement('canvas');
        var context = canvas.getContext('2d');
        // 过大的图片会下载失败
        canvas.width = content.clientWidth
        canvas.height = content.clientHeight
        context.drawImage(content, 0, 0);
        // 如果是PNG图片，则
        eleLink.href = canvas.toDataURL('image/png')
        // eleLink.href = context.toDataURL('image/jpeg');
      }

      // 触发点击
      document.body.appendChild(eleLink);
      eleLink.click();
      // 然后移除
      document.body.removeChild(eleLink);
    };
    // 监听浏览器后退
    $(document).ready(function (e) {
      var counter = 0;
      if (window.history && window.history.pushState) {
        // hash的变化会触发popstate及hashchange,浏览器的后退前进也行
        $(window).on('popstate', function () { // 能得到从pushState得到的state
          alert('支持监听后退')
          // pushState能修改地址栏而不刷新
          window.history.pushState('forward', null, '#');
          window.history.forward(1);
        });
      }
    });
    $(function () {
      // 使用Notification in window竟然不行???
      if (window.Notification) {
        Notification.requestPermission()
          .then(function (permission) {
            console.log(permission)
            if (permission === 'granted') {
              console.log('同意')
              new Notification('测试通知标题', {
                tag: '123',
                body: '我想要个女盆友'
              })
              setTimeout(function () {
                new Notification('测试通知标题', {
                  icon: '383c0ad208a31389.jpg',
                  tag: '123',
                  body: '么么哒',
                  renotify: true // 只能替换同tag值的通知
                })
              }, 2000)
            } else {
              console.log('拒绝')
            }
          });
      } else {
        alert('您的浏览器不支持Notification')
      }
      /*
      new Notification(title, options) 
      dir:ltr/rtl
      body: 文本
      tag: 标记
      icon: 左侧图标
      renotify: 替换之前的通知
      */
    })
  </script>
</body>

</html>